<div class="container mx-auto px-4 py-2 h-full">
  <div
    class="bg-white shadow rounded-lg p-6 flex flex-col h-full lg:col-span-2"
    *ngIf="userStories$ | async as userStories"
  >
    <div class="mb-4">
      <div class="flex items-center mt-2 justify-between">
        <div class="flex flex-col gap-2 min-w-0">
          <h1
            class="text-lg font-bold text-secondary-800 truncate max-w-full pr-8"
          >
            {{ newFileName.split("-")[0] }}:
            {{ navigation.selectedRequirement.title }}
          </h1>

          <div class="flex items-center">
            <h2 class="text-md font-semibold text-secondary-600">
              User Stories
            </h2>
            <app-badge [badgeText]="userStories.length"></app-badge>
          </div>
        </div>

        <div class="flex items-center justify-between gap-3">
          <app-button
            [buttonContent]="
              userStories.length === 0
                ? 'Generate User Stories'
                : 'Regenerate User Stories'
            "
            theme="secondary"
            size="sm"
            (click)="addMoreContext(userStories.length > 0)"
            rounded="lg"
          />
          <app-button
            [disabled]="userStories.length === 0"
            buttonContent="Export"
            theme="secondary"
            size="sm"
            rounded="lg"
            [matMenuTriggerFor]="exportOption"
          />
          <mat-menu #exportOption="matMenu">
            <button
              mat-menu-item
              class="rounded px-2 py-1 text-xs font-semibold text-primary-600 shadow-sm hover:bg-primary-100 mr-2"
              (click)="exportUserStories('json')"
            >
              Copy JSON to Clipboard
            </button>
            <button
              mat-menu-item
              class="rounded px-2 py-1 text-xs font-semibold text-primary-600 shadow-sm hover:bg-primary-100 mr-2"
              (click)="exportUserStories('xlsx')"
            >
              Download as Excel(.xlsx)
            </button>
            <button
              mat-menu-item
              class="rounded px-2 py-1 text-xs font-semibold text-primary-600 shadow-sm hover:bg-primary-100 mr-2"
              (click)="syncRequirementWithJira()"
            >
              Sync with Jira
            </button>
          </mat-menu>
          <app-button
            buttonContent="Add New"
            theme="primary"
            size="sm"
            rounded="lg"
            (click)="navigateToAddUserStory()"
          />
        </div>
      </div>
      <app-search-input
        *ngIf="userStories.length > 0"
        placeholder="Search..."
        (searchChange)="onSearch($event)"
      ></app-search-input>
    </div>

    <div class="h-full overflow-y-auto">
      <app-list-item
        [payload]="{
          description: userStory.formattedDescription ?? '',
          name: userStory.name,
          id: userStory.id,
          jiraTicketId: userStory.storyTicketId,
        }"
        *ngFor="let userStory of filteredUserStories$ | async; let i = index"
        [tag]="userStory.id"
        (click)="navigateToEditUserStory(userStory)"
        class="relative"
      >
        <div class="absolute top-4 right-4 flex gap-2">
          <app-button
            (click)="navigateToTaskList(userStory, i)"
            buttonContent="View Tasks"
            theme="secondary_outline"
            size="xs"
            rounded="lg"
          />
          <app-button
            theme="secondary_outline"
            size="xs"
            rounded="lg"
            [isIconButton]="true"
            icon="heroDocumentDuplicate"
            (click)="copyUserStoryContent($event, userStory)"
            matTooltip="Copy"
          />
        </div>
      </app-list-item>
      <h1
        class="font-semibold text-secondary-700 mt-4 text-center"
        *ngIf="(filteredUserStories$ | async)?.length === 0"
      >
        No User Stories Available.
      </h1>
    </div>
  </div>
</div>
